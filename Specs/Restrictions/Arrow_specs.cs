using SudokuSolver.Constraints;

namespace Specs.Restrictions.Arrow_specs;

public class Parses
{
    [Test]
    public void based_on_clues()
    {
        ImmutableArray<Constraint> rules =
        [
            .. Rules.Standard,
            Arrow.Parse("""
                ..2|3..|...
                ...|1..|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                """),
            Arrow.Parse("""
                ...|.1.|...
                ...|..2|...
                ...|.3.|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                """),
            Arrow.Parse("""
                ...|..3|2..
                ...|.4.|1..
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                """),

            Arrow.Parse("""
                ...|...|.21
                ...|...|..3
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                """),
            Arrow.Parse("""
                ...|...|...
                ...|...|...
                ...|...|21.
                ---+---+---
                ...|...|.3.
                ...|...|4..
                ...|...|5..
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                """),
            Arrow.Parse("""
                ...|...|...
                ..5|...|...
                .34|...|...
                ---+---+---
                21.|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                """),
            Arrow.Parse("""
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ..3|.1.|...
                ...|2..|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                """),
            Arrow.Parse("""
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                123|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                """),
            Arrow.Parse("""
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|3..|...
                ...|.2.|...
                ...|1..|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                """),
            Arrow.Parse("""
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|..1
                ...|...|..2
                ---+---+---
                ...|...|.3.
                ...|...|...
                ...|...|...
                """),
            Arrow.Parse("""
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                31.|...|...
                ---+---+---
                .2.|...|...
                ...|...|...
                ...|...|...
                """),
            Arrow.Parse("""
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ..5|.3.|...
                ---+---+---
                ...|4.2|1..
                ...|...|...
                ...|...|...
                """),
            Arrow.Parse("""
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ..1|.3.|...
                ...|2..|...
                ...|...|...
                """),
            Arrow.Parse("""
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                32.|...|...
                .1.|...|...
                """),
            Arrow.Parse("""
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ..1|.3.|...
                ...|2..|...
                ...|...|...
                """),
            Arrow.Parse("""
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|..2|...
                ...|.1.|3..
                """),
            Arrow.Parse("""
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|...
                ...|...|...
                ...|...|...
                ---+---+---
                ...|...|..3
                ...|...|.12
                ...|...|...
                """),
        ];

        var clues = Clues.Parse("""
            9.5|...|...
            ...|...|...
            ...|...|.9.
            ---+---+---
            ...|...|7..
            ...|.3.|...
            ..3|.1.|...
            ---+---+---
            ...|...|...
            ...|...|...
            ...|...|.3.
            """);

        var solution = DynamicSolver.Solve(clues, rules);

        solution.Should().Be("""
            965|481|327
            871|923|645
            432|756|198
            ---+---+---
            284|569|713
            716|234|589
            593|817|264
            ---+---+---
            648|372|951
            329|145|876
            157|698|432
            """, rules);
    }
}
